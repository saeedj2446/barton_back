// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// ==================== ENUMS ====================

// Ø¯Ø± ÙØ§ÛŒÙ„ prisma schema ÛŒØ§ enums Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡
enum SystemRole {
  USER
  ADMIN
  MODERATOR
  OPERATOR
  CONTENT_APPROVER
}

enum AccountRole {
  OWNER
  MANAGER
  FINANCE
  VIEWER
  SUPPORT
  PRODUCT_MANAGER
}

enum FileUsage {
  // Ø¹Ù…ÙˆÙ…ÛŒ
  GENERAL
  DOCUMENT

  // Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ (Ú©Ø§Ø±Ø¨Ø±Ø§Ù†)
  PROFILE_PHOTO
  ID_CARD_FRONT
  ID_CARD_BACK
  SELFIE_WITH_ID
  SIGNATURE
  BANK_CARD
  ADDRESS_PROOF

  // Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± / Ø³Ø§Ø²Ù…Ø§Ù†
  LOGO
  BANNER
  SHOP_FRONT
  INTERIOR_PHOTO
  SHOP_VIDEO
  CERTIFICATE
  LICENSE
  TAX_DOCUMENT
  REGISTRATION_DOC
  TEAM_PHOTO

  // Ù…Ø­ØµÙˆÙ„ / Ø®Ø¯Ù…Ø§Øª
  PRODUCT_IMAGE
  PRODUCT_GALLERY
  PRODUCT_VIDEO
  PRODUCT_LABEL
  PRODUCT_CERT
  PRODUCT_MANUAL

  // ØªØ¨Ù„ÛŒØºØ§Øª / Ù…Ø­ØªÙˆØ§ÛŒ Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ
  AD_BANNER
  PROMO_VIDEO
  SOCIAL_POST

  // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ùˆ ØªØ§ÛŒÛŒØ¯Ø§Øª
  SUPPORT_ATTACHMENT
  VERIFICATION_DOC
}

enum AccountActivityType {
  PERSONAL // Ú©Ø§Ø±Ø¨Ø± Ø´Ø®ØµÛŒ - ÙÙ‚Ø· Ø®Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…ØµØ±Ù
  RETAIL_BUYER // Ø®Ø±ÛŒØ¯Ø§Ø± Ø®Ø±Ø¯Ù‡â€ŒÙØ±ÙˆØ´ - Ø®Ø±ÛŒØ¯ Ø¹Ù…Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´ Ø®Ø±Ø¯Ù‡
  WHOLESALER // Ø¹Ù…Ø¯Ù‡â€ŒÙØ±ÙˆØ´ - ÙØ±ÙˆØ´ Ø¹Ù…Ø¯Ù‡
  MANUFACTURER // ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ - Ø®Ø±ÛŒØ¯ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡ + ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„
  SUPPLIER // ØªØ£Ù…ÛŒÙ†â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
  DISTRIBUTOR // Ù¾Ø®Ø´â€ŒÚ©Ù†Ù†Ø¯Ù‡
  SERVICE // Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø®Ø¯Ù…Ø§Øª
  BROKER // Ú©Ø§Ø±Ú¯Ø²Ø§Ø±
}

enum ProductStatus {
  PENDING // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ
  APPROVED // ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ùˆ ÙØ¹Ø§Ù„
  REJECTED // Ø±Ø¯ Ø´Ø¯Ù‡
  EDIT_PENDING // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ Ù¾Ø³ Ø§Ø² ÙˆÛŒØ±Ø§ÛŒØ´
  SUSPENDED // ØªØ¹Ù„ÛŒÙ‚ Ø´Ø¯Ù‡ (Ù…Ø«Ù„Ø§Ù‹ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ØªØ®Ù„Ù)
  INACTIVE // ØºÛŒØ±ÙØ¹Ø§Ù„ ØªÙˆØ³Ø· ÙØ±ÙˆØ´Ù†Ø¯Ù‡ ÛŒØ§ Ø³ÛŒØ³ØªÙ…
  OUT_OF_STOCK // Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ (Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØµÙØ±)
}

enum InteractionType {
  LIKE
  SAVE
  VIEW
}

enum OrderType {
  PACKAGE_PURCHASE
  PRODUCT_PURCHASE
  PAYMENT_REQUEST
  WITHDRAWAL_REQUEST
  DEPOSIT_REQUEST
  ESCROW_PAYMENT
  ESCROW_RELEASE
  ESCROW_REFUND
  SERVICE_PURCHASE
}

enum OrderStatus {
  PENDING
  PAID
  CONFIRMED
  PROCESSING
  COMPLETED
  CANCELLED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
  EXPIRED
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
  CANCELLED
  REFUNDED
  PARTIALLY_REFUNDED
  PROCESSING
}

enum TransactionType {
  DEBIT
  CREDIT
  BONUS
}

enum PaymentMethod {
  CREDIT_BALANCE
  ONLINE_GATEWAY
  BANK_TRANSFER
  WALLET
  CASH
  CRYPTO
}

// ÙØ¹Ø§Ù„ÛŒØªÙ‡Ø§ÛŒ Ù¾ÙˆÙ„ÛŒ
enum CreditActivityType {
  PRODUCT_BOOST
  SEND_BROADCAST
  FEATURED_BANNER
  VIDEO_UPLOAD
  INVITE_BONUS
  PRODUCT_CREATE
  PROFILE_COMPLETE
  DAILY_LOGIN
  REFERRAL_BONUS
  WELCOME_BONUS
  PACKAGE_PURCHASE
}

enum CreditActivityStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum UserActivityType {
  SEARCH_QUERY
  SEARCH_FILTER
  PRODUCT_VIEW
  ACCOUNT_VIEW
  PRODUCT_SAVE
  PRODUCT_LIKE
  CATEGORY_VIEW
  COMPARE_ACTION
}

enum PlanStatus {
  ACTIVE
  INACTIVE
  COMING_SOON
}

// ==================== NEW ENUMS ====================

enum CatalogStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  INACTIVE
}

enum SaleUnitType {
  PIECE
  WEIGHT
  VOLUME
  PACKAGE
  CONTAINER
}

enum SettlementType {
  CASH
  CHECK_3DAY
  CHECK_7DAY
  CHECK_15DAY
  CHECK_30DAY
  CHECK_60DAY
  BANK_TRANSFER
  CREDIT_30D
  CREDIT_60D
  CREDIT_90D
}

// Ø¶Ø±Ø§ÛŒØ¨ Ø§ÙØ²Ø§ÛŒØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨ØµÙˆØ±Øª Ú†Ú©
type SettlementMultipliers {
  // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ù†ÙˆØ§Ø¹ÛŒ Ú©Ù‡ Ø¶Ø±ÛŒØ¨ Ø¯Ø§Ø±Ù†Ø¯
  CHECK_3DAY  Float? @default(1.0)
  CHECK_7DAY  Float? @default(1.0)
  CHECK_15DAY Float? @default(1.1)
  CHECK_30DAY Float? @default(1.12)
  CHECK_60DAY Float? @default(1.15)
  CREDIT_30D  Float? @default(1.2)
  CREDIT_60D  Float? @default(1.25)
  CREDIT_90D  Float? @default(1.3)
  // CASH Ùˆ BANK_TRANSFER Ù‡Ù…ÛŒØ´Ù‡ 1.0 Ù‡Ø³ØªÙ†Ø¯
}

enum DeliveryMethod {
  SELLER_DELIVERY
  BUYER_PICKUP
  THIRD_PARTY
  EXPRESS
}

// ==================== MODELS ====================

model VerificationCode {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  code       String
  mobile     String
  expires_at DateTime
  user_id    String?  @db.ObjectId
  user       User?    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  created_at DateTime @default(now())

  @@map("verification_codes")
}

model User {
  id                  String    @id @default(auto()) @map("_id") @db.ObjectId
  created_at          DateTime  @default(now())
  user_name           String?   @unique
  first_name          String?
  last_name           String?
  sex                 String?
  province            String?
  city                String?
  activity_type       String?   @default("0") // ÙØ¹Ø§Ù„ÛŒØª Ø´Ø®ØµÛŒ ÛŒØ§ Ø´Ø±Ú©ØªÛŒ
  is_verified         Boolean   @default(false)
  is_buyer            Boolean   @default(false)
  is_seller           Boolean   @default(false)
  is_blocked          Boolean   @default(false)
  wallet_balance      Int       @default(0)
  category_id         Int?
  active_package_type Int       @default(0)
  package_end         DateTime?
  customer_status     String    @default("00000000")
  support_status      String    @default("00000000")
  coming_from         String?
  phone_allowed       Boolean   @default(true)
  product_count       Int       @default(0)
  response_rate       Float?
  has_phone           Boolean   @default(false)

  // Ø³ÛŒØ³ØªÙ… Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
  credit_level   Int @default(0)
  current_credit Int @default(0)
  total_spent    Int @default(0)
  bonus_credit   Int @default(0)

  // ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
  email       String?    @unique
  mobile      String?    @unique
  password    String
  system_role SystemRole @default(USER)

  // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
  account_users       AccountUser[]
  reviews             Review[]
  comments            Comment[]
  buy_ads             BuyAd[]
  products            Product[]
  interactions        Interaction[]
  credit_transactions CreditTransaction[]
  sent_messages       Message[]           @relation("SentMessages")
  conversations1      Conversation[]      @relation("ConversationUser1")
  conversations2      Conversation[]      @relation("ConversationUser2")
  verification_codes  VerificationCode[]
  files               File[]
  orders              Order[]
  credit_activities   CreditActivity[]
  seller_orders       Order[]             @relation("OrderSeller")
  transactions        Transaction[]
  user_activities     UserActivity[]
  user_behavior       UserBehavior?
  user_sessions       UserSession[]
  user_plans          UserPlan[]

  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([is_verified, is_blocked])
  @@index([created_at])
  @@index([credit_level])
  @@index([current_credit])
  @@map("users")
}

model Account {
  id                       String               @id @default(auto()) @map("_id") @db.ObjectId
  created_at               DateTime             @default(now())
  updated_at               DateTime             @updatedAt
  name                     String?
  activity_type            AccountActivityType? @default(PERSONAL)
  primery_category_id      Int?
  primery_category_name    String?
  categories               Json[]
  description              String?
  profile_description      String?              @map("profile_description")
  activity_domain          String?
  related_activity_history String?
  human_resource_count     String?
  profile_photo            String?
  public_phone             String?
  address                  String?
  postal_code              String?
  shaba_code               String?
  is_company               Boolean              @default(false)
  company_name             String?
  company_register_code    String?
  confirmed                Boolean              @default(false)
  is_active                Boolean              @default(true)
  current_badge_type       String?
  badge_expires_at         DateTime?
  total_views              Int                  @default(0)
  total_likes              Int                  @default(0)
  total_saves              Int                  @default(0)

  // ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø´Ø±Ø§ÛŒØ· Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ÙØ±ÙˆØ´
  default_settlement_types SettlementType[]
  default_delivery_methods DeliveryMethod[]
  default_min_order_qty    Int              @default(1)
  default_has_hamkar       Boolean          @default(false)
  default_hamkar_discount  Int?

  // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ù…ÙˆØ¬ÙˆØ¯
  settlement_multipliers SettlementMultipliers? // Ø¶Ø±Ø§ÛŒØ¨ Ø§ÙØ²Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ Ú†Ú© ÛŒØ§ Ø±ÙˆØ´Ù‡Ø§ÛŒ ØºÛŒØ± Ù†Ù‚Ø¯ÛŒ
  account_users          AccountUser[]
  products               Product[]
  buy_ads                BuyAd[]
  reviews                Review[]
  comments               Comment[]
  interactions           Interaction[]
  files                  File[]
  credit_transactions    CreditTransaction[]
  credit_activities      CreditActivity[]
  orders                 Order[]

  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([is_active, confirmed])
  @@index([activity_type, is_active])
  @@index([name])
  @@index([public_phone])
  @@index([created_at])
  @@index([current_badge_type])
  @@map("accounts")
}

model AccountUser {
  id           String      @id @default(auto()) @map("_id") @db.ObjectId
  created_at   DateTime    @default(now())
  account_role AccountRole @default(VIEWER)

  user_id    String @db.ObjectId
  account_id String @db.ObjectId

  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  account Account @relation(fields: [account_id], references: [id], onDelete: Cascade)

  @@unique([user_id, account_id])
  @@index([user_id])
  @@index([account_id])
  @@map("account_users")
}

// ==================== NEW MODELS ====================
model Category {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  name        String
  description String?
  parent_id   String?    @db.ObjectId
  parent      Category?  @relation("CategoryChildren", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children    Category[] @relation("CategoryChildren")
  bId         Int        @unique
  metadata    Json?

  // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
  catalogs Catalog[]
  specs    CategorySpec[] // âœ… Ø±Ø§Ø¨Ø·Ù‡ Ø¨Ø§ CategorySpec

  @@index([parent_id])
  @@map("categories")
}

model Spec {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())

  // ØªØ¹Ø±ÛŒÙ ÙˆÛŒÚ˜Ú¯ÛŒ Ù¾Ø§ÛŒÙ‡
  name      String // "brand", "color", "size"
  title     String // "Ø¨Ø±Ù†Ø¯", "Ø±Ù†Ú¯", "Ø³Ø§ÛŒØ²"
  data_type String // "string", "number", "boolean", "options"
  unit      String? // "Ú¯Ø±Ù…", "Ù„ÛŒØªØ±", "Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±"
  options   String[] // ["Ù‚Ø±Ù…Ø²", "Ø¢Ø¨ÛŒ", "Ø³Ø¨Ø²"]

  // Ø±Ø§Ø¨Ø·Ù‡ Ø¯ÙˆØ·Ø±ÙÙ‡
  category_specs CategorySpec[] // âœ… Ø±Ø§Ø¨Ø·Ù‡ Ø¨Ø§ CategorySpec

  @@unique([name])
  @@map("specs")
}

model CategorySpec {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  category_id String @db.ObjectId
  spec_id     String @db.ObjectId

  category Category @relation(fields: [category_id], references: [id])
  spec     Spec     @relation(fields: [spec_id], references: [id])

  // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø®ØµÙˆØµ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
  is_filterable  Boolean  @default(true)
  is_required    Boolean  @default(false)
  allowed_values String[] // Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ø¬Ø§Ø² Ù…Ø®ØµÙˆØµ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ

  @@unique([category_id, spec_id])
  @@map("category_specs")
}

// Ø§ÛŒÙ† Ø¨Ù‡ ØµÙˆØ±Øª TypeScript type ØªØ¹Ø±ÛŒÙ Ù…ÛŒØ´Ù‡ØŒ Ù†Ù‡ Ù…Ø¯Ù„ Prisma!
type SaleUnit {
  unit_code         String
  unit_name         String
  unit_type         String // "WEIGHT", "VOLUME", "PIECE", "PACKAGE"
  quantity          Float
  unit_label        String
  base_unit         String?
  conversion_factor Float?
  description       String?
  is_available      Boolean?
  min_quantity      Float?
  max_quantity      Float?
}

model Catalog {
  id             String        @id @default(auto()) @map("_id") @db.ObjectId
  created_at     DateTime      @default(now())
  updated_at     DateTime      @updatedAt
  name           String
  description    String?
  category_id    String        @db.ObjectId
  category       Category      @relation(fields: [category_id], references: [id])
  specifications Json? // Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ ÙÛŒÙ„ØªØ±
  filter_tags    String[]
  status         CatalogStatus @default(PENDING)
  confirmed      Boolean       @default(false)

  // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
  sale_units      SaleUnit[]
  sale_conditions SaleCondition[]
  products        Product[]
  attributes      CatalogAttribute[] // âœ… Ø¬Ø¯ÛŒØ¯

  @@index([category_id])
  @@index([filter_tags])
  @@index([status])
  @@map("catalogs")
}

model CatalogAttribute {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  catalog_id String  @db.ObjectId
  catalog    Catalog @relation(fields: [catalog_id], references: [id])
  name       String // "brand", "model", "diameter", "grain_size"
  value      String // "Ø³Ø§Ù…Ø³ÙˆÙ†Ú¯", "S23", "50mm", "Ø¯Ø±Ø´Øª"

  @@unique([catalog_id, name])
  @@index([name, value]) // Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø³Ø±ÛŒØ¹
  @@map("catalog_attributes")
}

model SaleCondition {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
  product_id String  @db.ObjectId
  product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  catalog_id String  @db.ObjectId
  catalog    Catalog @relation(fields: [catalog_id], references: [id], onDelete: Cascade)

  // ==================== Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù¾Ø§ÛŒÙ‡ ====================
  base_unit      String // ÙˆØ§Ø­Ø¯ Ù¾Ø§ÛŒÙ‡ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ (Ø§Ø² sale_units Ú©Ø§ØªØ§Ù„ÙˆÚ¯)
  price_per_unit Int // Ù‚ÛŒÙ…Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙˆØ§Ø­Ø¯
  min_order_qty  Int // Ø­Ø¯Ø§Ù‚Ù„ ØªØ¹Ø¯Ø§Ø¯/Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø§Ø¨Ù„ Ø³ÙØ§Ø±Ø´
  max_order_qty  Int? // Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯/Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø§Ø¨Ù„ Ø³ÙØ§Ø±Ø´

  // ==================== Ø´Ø±Ø§ÛŒØ· Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ ØªØ­ÙˆÛŒÙ„ ====================
  settlement_types SettlementType[] // Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨
  delivery_methods DeliveryMethod[] // Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ ØªØ­ÙˆÛŒÙ„

  // ==================== Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ - Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ ====================

  // ğŸ†• Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ
  pricing_strategy String @default("SIMPLE") // "SIMPLE", "TIERED", "GROUP_BASED", "SEASONAL"

  // ğŸ†• Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù¾Ù„Ú©Ø§Ù†ÛŒ (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·ÙˆØ­ ØªØ®ÙÛŒÙ)
  tiered_pricing Json? // [
  //   { min_qty: 100, price: 95000, discount_percent: 5 },
  //   { min_qty: 500, price: 90000, discount_percent: 10 },
  //   { min_qty: 1000, price: 85000, discount_percent: 15 }
  // ]

  // ğŸ†• ØªØ®ÙÛŒÙâ€ŒÙ‡Ø§ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ù…Ø´ØªØ±ÛŒ)
  group_discounts Json? // [
  //   { group_type: "WHOLESALER", discount_percent: 20, min_orders: 5 },
  //   { group_type: "RETAILER", discount_percent: 15, min_orders: 10 },
  //   { group_type: "VIP_CUSTOMER", discount_percent: 25 }
  // ]

  // ğŸ†• ØªØ®ÙÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù†)
  seasonal_discounts Json? // [
  //   {
  //     name: "ØªØ®ÙÛŒÙ Ø²Ù…Ø³ØªØ§Ù†Ù‡",
  //     discount_percent: 10,
  //     start_date: "2024-12-01",
  //     end_date: "2024-02-28",
  //     is_active: true
  //   }
  // ]

  // ğŸ†• Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ù†Ø·Ù‚Ù‡â€ŒØ§ÛŒ (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ù†Ø·Ù‚Ù‡)
  regional_pricing Json? // [
  //   { province: "ØªÙ‡Ø±Ø§Ù†", price: 105000, extra_charge: 5000 },
  //   { province: "Ù…Ø´Ù‡Ø¯", price: 100000, extra_charge: 0 },
  //   { province: "Ø´Ù‡Ø±Ø³ØªØ§Ù†â€ŒÙ‡Ø§", price: 110000, extra_charge: 10000 }
  // ]

  // ğŸ†• Ø´Ø±Ø§ÛŒØ· Ø®Ø§Øµ (Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ØªØ±Ú©ÛŒØ¨ÛŒ)
  special_conditions Json? // {
  //   min_cart_value: 1000000,        // Ø­Ø¯Ø§Ù‚Ù„ Ø§Ø±Ø²Ø´ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
  //   combo_products: ["prod1", "prod2"], // Ù…Ø­ØµÙˆÙ„Ø§Øª ØªØ±Ú©ÛŒØ¨ÛŒ
  //   loyalty_tier: "GOLD",           // Ø³Ø·Ø­ ÙˆÙØ§Ø¯Ø§Ø±ÛŒ
  //   business_size: "LARGE"          // Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±
  // }

  // ==================== ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø±ÛŒØ¹ ====================

  // ğŸ†• Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø³Ø±ÛŒØ¹ - Ø§ÛŒÙ† ÙÛŒÙ„Ø¯Ù‡Ø§ Ù‡Ù†Ú¯Ø§Ù… Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
  max_discount_percent Int? // Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø¯Ø±ØµØ¯ ØªØ®ÙÛŒÙ Ø¯Ø± Ø¨ÛŒÙ† ØªÙ…Ø§Ù… Ø³Ø·ÙˆØ­
  min_effective_price  Int? // Ú©Ù…ØªØ±ÛŒÙ† Ù‚ÛŒÙ…Øª Ù…ÙˆØ«Ø± (Ø¨Ø§ Ø§Ø­ØªØ³Ø§Ø¨ Ù‡Ù…Ù‡ ØªØ®ÙÛŒÙâ€ŒÙ‡Ø§)
  has_any_discount     Boolean  @default(false) // Ø¢ÛŒØ§ Ù‡Ø±Ú¯ÙˆÙ†Ù‡ ØªØ®ÙÛŒÙ Ø¯Ø§Ø±Ø¯ØŸ
  discount_types       String[] // Ø§Ù†ÙˆØ§Ø¹ ØªØ®ÙÛŒÙâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯: ["BULK", "HAMKAR", "SEASONAL", "GROUP"]

  // ğŸ†• Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø±Ø¹Øª ØªØ­ÙˆÛŒÙ„
  estimated_delivery_days Int? // Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ­ÙˆÛŒÙ„
  has_express_delivery    Boolean @default(false) // Ø¢ÛŒØ§ ØªØ­ÙˆÛŒÙ„ Ø³Ø±ÛŒØ¹ Ø¯Ø§Ø±Ø¯ØŸ

  // ğŸ†• Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ø±Ø§ÛŒØ· Ù¾Ø±Ø¯Ø§Ø®Øª
  has_credit_payment Boolean @default(false) // Ø¢ÛŒØ§ Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ Ø¯Ø§Ø±Ø¯ØŸ
  max_credit_days    Int? // Ø­Ø¯Ø§Ú©Ø«Ø± Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±

  // ==================== Ø´Ø±Ø§ÛŒØ· ÙˆÛŒÚ˜Ù‡ Ù…ÙˆØ¬ÙˆØ¯ ====================
  has_hamkar_discount     Boolean @default(false)
  hamkar_discount_percent Int?
  has_bulk_pricing        Boolean @default(false)
  bulk_min_qty            Int?
  bulk_price              Int?

  // ==================== ÙˆØ¶Ø¹ÛŒØª ====================
  is_active  Boolean @default(true)
  is_default Boolean @default(false)

  // ==================== Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø±ÛŒØ¹ ====================
  @@index([product_id, price_per_unit])
  @@index([catalog_id, settlement_types])
  @@index([base_unit, min_order_qty])
  @@index([pricing_strategy]) // ğŸ†• Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ
  @@index([has_any_discount]) // ğŸ†• Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø§Ø±Ø§ÛŒ ØªØ®ÙÛŒÙ
  @@index([max_discount_percent]) // ğŸ†• Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÛŒØ²Ø§Ù† ØªØ®ÙÛŒÙ
  @@index([min_effective_price]) // ğŸ†• Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ
  @@index([has_express_delivery]) // ğŸ†• Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± ØªØ­ÙˆÛŒÙ„ Ø³Ø±ÛŒØ¹
  @@index([has_credit_payment]) // ğŸ†• Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ± Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
  @@index([is_active, has_any_discount]) // ğŸ†• ØªØ±Ú©ÛŒØ¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ØªØ±
  @@map("sale_conditions")
}

model Product {
  id                       String        @id @default(auto()) @map("_id") @db.ObjectId
  created_at               DateTime      @default(now())
  updated_at               DateTime      @updatedAt
  p_created_at             DateTime?     @map("p_created_at")
  name             String
  stock                    Int           @default(0)
  description              String?
  address                  String?
  unit                     String
  is_rejected              Boolean       @default(false)
  has_video                Boolean       @default(false)
  is_old                   Boolean       @default(false)
  confirmed                Boolean       @default(false)
  status                   ProductStatus @default(APPROVED)
  last_price_update        DateTime?     @map("last_price_update")
  total_views              Int           @default(0)
  total_likes              Int           @default(0)
  total_saves              Int           @default(0)
  province_name            String?
  province_id              Int?
  city_name                String?
  city_id                  Int?
  boost_power              Int           @default(0)
  boost_expires_at         DateTime?
  boost_purchased          Boolean       @default(false)
  boost_is_elevated        Boolean       @default(false)
  category_id              Int?
  category_name            String?
  sub_category_id          Int?
  sub_category_name        String?
  super_category_name      String?
  is_brands_representative Boolean       @default(false)

  // ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ú©Ø§ØªØ§Ù„ÙˆÚ¯
  catalog_id String?  @db.ObjectId
  catalog    Catalog? @relation(fields: [catalog_id], references: [id], onDelete: Cascade)

  // Ø­Ø°Ù ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù‚ÛŒÙ…Øª
  // âŒ min_sale_price Int
  // âŒ max_sale_price Int?
  // âŒ min_sale_amount Int
  // âŒ brand_name String

  account_id          String              @db.ObjectId
  account             Account             @relation(fields: [account_id], references: [id], onDelete: Cascade)
  user_id             String              @db.ObjectId
  user                User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  files               File[]
  reviews             Review[]
  comments            Comment[]
  interactions        Interaction[]
  credit_transactions CreditTransaction[]
  credit_activities   CreditActivity[]
  order_items         OrderItem[]
  user_activities     UserActivity[]

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ø´Ø±Ø§ÛŒØ· ÙØ±ÙˆØ´
  sale_conditions SaleCondition[]

  @@index([account_id])
  @@index([user_id])
  @@index([category_id, sub_category_id])
  @@index([boost_is_elevated, confirmed])
  @@index([created_at])
  @@index([province_id, city_id])
  @@index([total_views])
  @@index([total_likes])
  @@index([catalog_id]) // Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¬Ø¯ÛŒØ¯
  @@map("products")
}

model BuyAd {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at         DateTime @default(now())
  name               String?
  requirement_amount Int
  register_date      DateTime @map("register_date")

  // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
  category_id      Int?
  category_name    String?
  subcategory_name String?
  unit             String

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
  first_name        String?
  last_name         String?
  is_verified       Boolean          @default(false)
  status            ProductStatus    @default(APPROVED)
  // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
  account_id        String           @db.ObjectId
  account           Account          @relation(fields: [account_id], references: [id], onDelete: Cascade)
  user_id           String           @db.ObjectId
  user              User             @relation(fields: [user_id], references: [id], onDelete: Cascade)
  credit_activities CreditActivity[]

  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([account_id])
  @@index([user_id])
  @@index([category_id])
  @@index([created_at])
  @@map("buy_ads")
}

model Review {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at    DateTime @default(now())
  rating_score  Int      @default(5)
  comment       String?
  confirmed     Boolean  @default(false)
  likes         Int      @default(0)
  already_liked Boolean  @default(false)

  // Ú©Ø§Ø±Ø¨Ø± Ù†Ø¸Ø± Ø¯Ù‡Ù†Ø¯Ù‡
  user_id    String  @db.ObjectId
  first_name String?
  last_name  String?
  city       String?
  province   String?

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ø§Ú©Ø§Ù†Øª
  product_id String?  @db.ObjectId
  product    Product? @relation(fields: [product_id], references: [id], onDelete: Cascade)
  account_id String?  @db.ObjectId
  account    Account? @relation(fields: [account_id], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± ÙÙ‚Ø· ÛŒÚ© Ù†Ø¸Ø± Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø­ØµÙˆÙ„/Ø§Ú©Ø§Ù†Øª
  @@unique([user_id, product_id])
  @@unique([user_id, account_id])
  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([product_id, created_at])
  @@index([account_id, created_at])
  @@index([user_id, created_at])
  @@index([rating_score])
  @@index([confirmed])
  @@map("reviews")
}

model Comment {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at    DateTime @default(now())
  content       String
  confirmed     Boolean  @default(false)
  likes         Int      @default(0)
  already_liked Boolean  @default(false)

  // Ú©Ø§Ø±Ø¨Ø± Ú©Ø§Ù…Ù†Øª Ø¯Ù‡Ù†Ø¯Ù‡
  user_id    String  @db.ObjectId
  first_name String?
  last_name  String?
  city       String?
  province   String?

  // Ø³ÛŒØ³ØªÙ… Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ
  parent_id String?   @db.ObjectId
  parent    Comment?  @relation("CommentReplies", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  replies   Comment[] @relation("CommentReplies")

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ø§Ú©Ø§Ù†Øª
  product_id String?  @db.ObjectId
  product    Product? @relation(fields: [product_id], references: [id], onDelete: Cascade)
  account_id String?  @db.ObjectId
  account    Account? @relation(fields: [account_id], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([product_id, created_at])
  @@index([account_id, created_at])
  @@index([user_id, created_at])
  @@index([parent_id])
  @@index([confirmed])
  @@map("comments")
}

model Interaction {
  id         String          @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime        @default(now())
  type       InteractionType

  // Ú©Ø§Ø±Ø¨Ø± Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù†Ø¯Ù‡
  user_id String @db.ObjectId
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ø§Ú©Ø§Ù†Øª
  product_id String?  @db.ObjectId
  product    Product? @relation(fields: [product_id], references: [id], onDelete: Cascade)
  account_id String?  @db.ObjectId
  account    Account? @relation(fields: [account_id], references: [id], onDelete: Cascade)

  // Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù„Ø§ÛŒÚ©/Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†Ø¯ (ÙˆÛŒÙˆ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø¯Ø§Ø±Ø¯)
  @@unique([user_id, product_id, type])
  @@unique([user_id, account_id, type])
  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([product_id, type, created_at])
  @@index([account_id, type, created_at])
  @@index([user_id, type])
  @@index([type, created_at])
  @@map("interactions")
}

model File {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  created_at     DateTime  @default(now())
  file_path      String
  thumbnail_path String?   @map("thumbnail_path")
  status         String?   @default("2")
  mime           Int?
  upload_date    DateTime? @map("upload_date")
  file_usage     FileUsage
  description    String?

  // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
  product_id String?  @db.ObjectId
  product    Product? @relation(fields: [product_id], references: [id], onDelete: Cascade)
  account_id String?  @db.ObjectId
  account    Account? @relation(fields: [account_id], references: [id], onDelete: Cascade)
  user_id    String?  @db.ObjectId
  user       User?    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([product_id])
  @@index([account_id])
  @@index([user_id])
  @@index([file_usage])
  @@index([created_at])
  @@map("files")
}

model Conversation {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Ø¯Ùˆ Ø·Ø±Ù Ú¯ÙØªÚ¯Ùˆ
  user1_id String @db.ObjectId
  user2_id String @db.ObjectId
  user1    User   @relation("ConversationUser1", fields: [user1_id], references: [id])
  user2    User   @relation("ConversationUser2", fields: [user2_id], references: [id])

  // Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
  messages Message[]

  // Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù… Ø¨Ø±Ø§ÛŒ performance
  last_message_text String?
  last_message_time DateTime?

  // ÙˆØ¶Ø¹ÛŒØª Ø®ÙˆØ§Ù†Ø¯Ù†
  user1_last_read_at DateTime?
  user2_last_read_at DateTime?

  @@unique([user1_id, user2_id])
  @@index([user1_id, updated_at])
  @@index([user2_id, updated_at])
  @@index([updated_at])
  @@map("conversations")
}

model Message {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())
  content    String
  is_read    Boolean  @default(false)

  // ÙØ±Ø³ØªÙ†Ø¯Ù‡
  sender_id String @db.ObjectId
  sender    User   @relation("SentMessages", fields: [sender_id], references: [id], onDelete: Cascade)

  // Ú¯ÙØªÚ¯ÙˆÛŒ Ù…Ø±ØªØ¨Ø·
  conversation_id String       @db.ObjectId
  conversation    Conversation @relation(fields: [conversation_id], references: [id], onDelete: Cascade)

  @@index([conversation_id, created_at])
  @@index([sender_id, created_at])
  @@index([is_read])
  @@map("messages")
}

model Order {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  order_number String   @unique

  // Ù†ÙˆØ¹ Ø³ÙØ§Ø±Ø´
  order_type OrderType
  status     OrderStatus @default(PENDING)

  // Ú©Ø§Ø±Ø¨Ø± Ù…Ø±ØªØ¨Ø·
  user_id String @db.ObjectId
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // ÙØ±ÙˆØ´Ù†Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´Ø§Øª Ø®Ø±ÛŒØ¯ Ø§Ø² Ø¯ÛŒÚ¯Ø±Ø§Ù†)
  seller_id String? @db.ObjectId
  seller    User?   @relation("OrderSeller", fields: [seller_id], references: [id])

  // Ø§Ú©Ø§Ù†Øª Ù…Ø±ØªØ¨Ø·
  account_id String?  @db.ObjectId
  account    Account? @relation(fields: [account_id], references: [id], onDelete: Cascade)

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§Ù„ÛŒ
  total_amount    Int
  tax_amount      Int @default(0)
  discount_amount Int @default(0)
  net_amount      Int

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øª
  payment_method PaymentMethod?
  paid_at        DateTime?

  // Ù…Ù‡Ù„Øª Ù¾Ø±Ø¯Ø§Ø®Øª
  expires_at DateTime?

  // Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´
  items OrderItem[]

  // ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª
  transactions Transaction[]

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø³ÙØ§Ø±Ø´
  metadata Json?

  // ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ØªØ³ÙˆÛŒÙ‡
  settled_at           DateTime?
  settlement_reference String?

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
  credit_activities CreditActivity[]

  @@index([user_id, created_at])
  @@index([seller_id, created_at])
  @@index([order_type, status])
  @@index([status, created_at])
  @@map("orders")
}

model OrderItem {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())
  order_id   String   @db.ObjectId
  order      Order    @relation(fields: [order_id], references: [id], onDelete: Cascade)

  // Ù†ÙˆØ¹ Ø¢ÛŒØªÙ…
  item_type  String
  item_id    String? @db.ObjectId
  item_title String

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚ÛŒÙ…Øª Ùˆ Ù…Ù‚Ø¯Ø§Ø±
  quantity    Int @default(1)
  unit_price  Int
  total_price Int

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒ
  description String?

  // Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª ÙÛŒØ²ÛŒÚ©ÛŒ
  product_id String?  @db.ObjectId
  product    Product? @relation(fields: [product_id], references: [id])

  @@index([order_id])
  @@index([item_type, item_id])
  @@map("order_items")
}

model Transaction {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at         DateTime @default(now())
  updated_at         DateTime @updatedAt
  transaction_number String   @unique

  // ÙˆØ¶Ø¹ÛŒØª ØªØ±Ø§Ú©Ù†Ø´
  status TransactionStatus @default(PENDING)

  // Ø³ÙØ§Ø±Ø´ Ù…Ø±ØªØ¨Ø·
  order_id String @db.ObjectId
  order    Order  @relation(fields: [order_id], references: [id], onDelete: Cascade)

  // Ú©Ø§Ø±Ø¨Ø± Ù…Ø±ØªØ¨Ø·
  user_id String @db.ObjectId
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§Ù„ÛŒ
  amount     Int
  fee        Int    @default(0)
  net_amount Int
  currency   String @default("IRR")

  // Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´
  transaction_type TransactionType

  // Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª
  payment_method PaymentMethod?

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øª
  gateway_reference String?
  gateway_response  Json?

  // Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù…
  processed_at DateTime?
  completed_at DateTime?

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®Ø·Ø§ Ùˆ Ø¨Ø§Ø²Ù¾Ø±Ø¯Ø§Ø®Øª
  error_code    String?
  error_message String?
  refund_amount Int?
  refund_reason String?
  refunded_at   DateTime?

  // ØªØ£ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ
  verified_by String?
  verified_at DateTime?
  notes       String?

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
  credit_transaction CreditTransaction?
  UserPlan           UserPlan[]

  @@index([order_id])
  @@index([user_id, created_at])
  @@index([created_at])
  @@map("transactions")
}

model CreditTransaction {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())

  // Ú©Ø§Ø±Ø¨Ø± Ù…Ø±ØªØ¨Ø·
  user_id String @db.ObjectId
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // Ø§Ú©Ø§Ù†Øª Ù…Ø±ØªØ¨Ø·
  account_id String?  @db.ObjectId
  account    Account? @relation(fields: [account_id], references: [id], onDelete: Cascade)

  // Ù…Ø­ØµÙˆÙ„ Ù…Ø±ØªØ¨Ø·
  product_id String?  @db.ObjectId
  product    Product? @relation(fields: [product_id], references: [id], onDelete: Cascade)

  // ØªØ±Ø§Ú©Ù†Ø´ Ø§ØµÙ„ÛŒ Ù…Ø±ØªØ¨Ø·
  transaction_id String?      @unique @db.ObjectId
  transaction    Transaction? @relation(fields: [transaction_id], references: [id])

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
  amount        Int
  balance_after Int
  activity_type String
  quantity      Int?
  description   String?

  // Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
  credit_transaction_type TransactionType  @default(DEBIT)
  credit_activities       CreditActivity[]

  @@index([user_id, created_at])
  @@index([account_id, created_at])
  @@index([activity_type])
  @@map("credit_transactions")
}

model CreditActivity {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())

  // Ú©Ø§Ø±Ø¨Ø± Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù†Ø¯Ù‡
  user_id String @db.ObjectId
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // Ø§Ú©Ø§Ù†Øª Ù…Ø±ØªØ¨Ø·
  account_id String?  @db.ObjectId
  account    Account? @relation(fields: [account_id], references: [id], onDelete: Cascade)

  // Ù…Ø­ØµÙˆÙ„ Ù…Ø±ØªØ¨Ø·
  product_id String?  @db.ObjectId
  product    Product? @relation(fields: [product_id], references: [id], onDelete: Cascade)

  // Ø³ÙØ§Ø±Ø´ Ù…Ø±ØªØ¨Ø·
  order_id String? @db.ObjectId
  order    Order?  @relation(fields: [order_id], references: [id], onDelete: Cascade)

  // Ø¢Ú¯Ù‡ÛŒ Ø®Ø±ÛŒØ¯ Ù…Ø±ØªØ¨Ø·
  buy_ad_id String? @db.ObjectId
  buy_ad    BuyAd?  @relation(fields: [buy_ad_id], references: [id], onDelete: Cascade)

  // ØªØ±Ø§Ú©Ù†Ø´ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ Ù…Ø±ØªØ¨Ø·
  credit_transaction_id String?            @db.ObjectId
  credit_transaction    CreditTransaction? @relation(fields: [credit_transaction_id], references: [id], onDelete: Cascade)

  // Ù†ÙˆØ¹ ÙØ¹Ø§Ù„ÛŒØª
  activity_type CreditActivityType

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ø§Ù„ÛŒØª
  quantity     Int                  @default(1)
  unit_price   Int
  total_cost   Int
  user_plan_id String?              @db.ObjectId
  user_plan    UserPlan?            @relation(fields: [user_plan_id], references: [id], onDelete: Cascade)
  // ÙˆØ¶Ø¹ÛŒØª
  status       CreditActivityStatus @default(PENDING)

  @@index([user_id, created_at])
  @@index([account_id, created_at])
  @@index([order_id])
  @@index([activity_type])
  @@index([status])
  @@map("credit_activities")
}

model UserActivity {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())

  // Ú©Ø§Ø±Ø¨Ø±
  user_id String @db.ObjectId
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // Ù†ÙˆØ¹ ÙØ¹Ø§Ù„ÛŒØª
  activity_type UserActivityType

  // Ù‡Ø¯Ù ÙØ¹Ø§Ù„ÛŒØª
  target_type String?
  target_id   String? @db.ObjectId

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø®ØªØµØ± Ùˆ Ù…ÙÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ
  metadata Json?

  // ÙˆØ²Ù† ÙØ¹Ø§Ù„ÛŒØª (Ø¨Ø±Ø§ÛŒ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯)
  weight Int @default(1)

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø­ØµÙˆÙ„ (Ø§Ú¯Ø± Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­ØµÙˆÙ„ Ø¨Ø§Ø´Ø¯)
  product_id String?  @db.ObjectId
  product    Product? @relation(fields: [product_id], references: [id], onDelete: Cascade)

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø¬Ù„Ø³Ù‡
  session_id String?      @db.ObjectId
  session    UserSession? @relation(fields: [session_id], references: [id], onDelete: Cascade)

  @@index([user_id, created_at])
  @@index([activity_type, created_at])
  @@index([target_type, target_id])
  @@index([user_id, activity_type])
  @@map("user_activities")
}

model UserBehavior {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  user_id    String   @unique @db.ObjectId
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  updated_at DateTime @updatedAt

  // Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
  interests Json?

  // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
  search_patterns Json?

  // ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø®ØªØµØ±
  recent_searches String[]
  recent_views    String[]
  recent_saves    String[]

  // Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ¹ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
  total_searches Int       @default(0)
  total_views    Int       @default(0)
  total_saves    Int       @default(0)
  last_active    DateTime?

  @@index([updated_at])
  @@map("user_behaviors")
}

model UserSession {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  user_id    String    @db.ObjectId
  user       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  started_at DateTime  @default(now())
  ended_at   DateTime?

  // ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡
  activities UserActivity[]

  // Ø®Ù„Ø§ØµÙ‡ Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ø§ÛŒ Ø¢Ù†Ø§Ù„ÛŒØ²
  session_type              String?
  number_of_pages_visited   Int     @default(0) // ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø´Ø¯Ù‡
  number_of_products_viewed Int     @default(0)
  number_of_searches_made   Int     @default(0)

  @@index([user_id, started_at])
  @@index([started_at])
  @@map("user_sessions")
}

model Plan {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡
  name        String
  level       Int     @unique // Ø³Ø·Ø­ Ù¾Ù„Ù† (1, 2, 3, ...)
  description String?

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚ÛŒÙ…Øª Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±
  price         Int // Ù‚ÛŒÙ…Øª Ø¨Ù‡ Ø±ÛŒØ§Ù„
  credit_amount Int // Ù…ÛŒØ²Ø§Ù† Ø§Ø¹ØªØ¨Ø§Ø± Ø§ØµÙ„ÛŒ
  bonus_credit  Int @default(0) // Ø§Ø¹ØªØ¨Ø§Ø± Ù‡Ø¯ÛŒÙ‡
  total_credit  Int // Ø§Ø¹ØªØ¨Ø§Ø± Ú©Ù„ (credit_amount + bonus_credit)

  // Ù…Ø¯Øª Ø²Ù…Ø§Ù†
  expiry_days Int // Ù…Ø¯Øª Ø§Ø¹ØªØ¨Ø§Ø± Ø¨Ù‡ Ø±ÙˆØ²

  // ÙˆØ¶Ø¹ÛŒØª
  status     PlanStatus @default(ACTIVE)
  is_popular Boolean    @default(false)

  // Ù…Ø²Ø§ÛŒØ§
  benefits String[] // Ù„ÛŒØ³Øª Ù…Ø²Ø§ÛŒØ§

  // Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
  user_plans UserPlan[]

  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([status])
  @@index([price])
  @@index([is_popular])
  @@map("plans")
}

model UserPlan {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Ú©Ø§Ø±Ø¨Ø± Ùˆ Ù¾Ù„Ù†
  user_id String @db.ObjectId
  plan_id String @db.ObjectId
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  plan    Plan   @relation(fields: [plan_id], references: [id], onDelete: Cascade)

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ
  start_date DateTime @default(now())
  end_date   DateTime // ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§
  is_active  Boolean  @default(true)

  // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡
  initial_credit   Int // Ø§Ø¹ØªØ¨Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡
  remaining_credit Int // Ø§Ø¹ØªØ¨Ø§Ø± Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡
  used_credit      Int @default(0) // Ø§Ø¹ØªØ¨Ø§Ø± Ù…ØµØ±Ù Ø´Ø¯Ù‡

  // ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø±ØªØ¨Ø·
  transaction_id String?      @db.ObjectId
  transaction    Transaction? @relation(fields: [transaction_id], references: [id])

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
  credit_activities CreditActivity[]

  // Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± ÙÙ‚Ø· ÛŒÚ© Ù¾Ù„Ù† ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
  @@unique([user_id, plan_id, is_active])
  // Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ
  @@index([user_id, is_active])
  @@index([plan_id])
  @@index([end_date])
  @@index([is_active, end_date])
  @@map("user_plans")
}
